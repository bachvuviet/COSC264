1a)
create table JobSkill
  (JobName  varchar(50),
   S_code   char references Skill(S_code),
   Rank     int,
   primary key (JobName, S_code)
  );

1b)
INSERT INTO JobSkill VALUES ('SWDeveloper', 'C', 2);
INSERT INTO JobSkill VALUES ('SWDeveloper', 'D', 3);
INSERT INTO JobSkill VALUES ('SWDeveloper', 'T', 1);
INSERT INTO JobSkill VALUES ('Lifeguard', 'F', 2);
INSERT INTO JobSkill VALUES ('Lifeguard', 'S', 1);

1c)
Select Count(*) from JobSkill;
  COUNT(*)
----------
	 5

1d)
Update Creature
set C_name = 'Smeagol' where C_name = 'Gollum';

2a)
Select distinct C_name from Creature, Skill, Achievement
where S_weight <= 0.5
and Creature.C_id = Achievement.C_id
and Skill.S_code = Achievement.S_code
order by C_name asc;

Select distinct C_name from Creature
Join Achievement on (Creature.C_id = Achievement.C_id)
Join Skill on (Skill.S_code = Achievement.S_code)
where S_weight <= 0.5
order by C_name asc;

C_NAME
---------------
Bannon
Neff
Smeagol

2b)
Select distinct C_name from Creature
where C_id IN (Select C_id from Achievement 
                where S_code IN (Select S_code from Skill
                                Where S_weight <= 0.5))
order by C_name asc;

2c)
Select C_type, Count(*) as Skill_num, avg(score)
from Creature C
Join Achievement A on (C.C_id = A.C_id)
Join Skill S on (S.S_code = A.S_code)
group by C_type
order by Skill_num desc;

C_TYPE	    SKILL_NUM AVG(SCORE)
---------- ---------- ----------
Person		   11 2.09090909
Hobbit		    2	     1.5
Dragon		    1	       1

2d)
Select distinct S1.S_code, S2.S_code
from Skill S1 cross join Skill S2;  --Cartesian

Select distinct A1.S_code, A2.S_code from Achievement A1, Achievement A2
where A1.S_code < A2.S_code
and A1.score = 2
and A2.score = 2;

S S
- -
F R
F S
F T
R T
R S
S T

2e)
Select C.C_id, count(A.S_code) as Skill_num
from Creature C left outer join achievement A on (C.C_id = A.C_id)
Group by C.C_id
order by C_id;

      C_ID  SKILL_NUM
---------- ----------
	 1	    3
	 2	    1
	 3	    2
	 4	    2
	 5	    3
	 6	    0
	 7	    2
	 8	    1

3a)
create view ACH_VIEW as
select C.C_id, C_name, C_type, A.S_code, A.Score, S_desc
from creature C join achievement A on (C.C_id = A.C_id)
join skill s on (S.S_code = A.S_code);

      C_ID C_NAME	   C_TYPE     S      SCORE S_DESC
---------- --------------- ---------- - ---------- ---------------
	 8 Smaug	   Dragon     B 	 1 Breathe fire
	 5 Mieska	   Person     C 	 3 Code
	 1 Bannon	   Person     C 	 3 Code
	 5 Mieska	   Person     D 	 1 Design
	 3 Neff 	   Person     D 	 1 Design
	 7 Smeagol	   Hobbit     F 	 1 Float
	 4 Neff 	   Person     F 	 2 Float
	 1 Bannon	   Person     F 	 3 Float
	 7 Smeagol	   Hobbit     R 	 2 Riddle
	 4 Neff 	   Person     S 	 2 Swim
	 3 Neff 	   Person     S 	 2 Swim

      C_ID C_NAME	   C_TYPE     S      SCORE S_DESC
---------- --------------- ---------- - ---------- ---------------
	 2 Myers	   Person     S 	 3 Swim
	 1 Bannon	   Person     S 	 1 Swim
	 5 Mieska	   Person     T 	 2 Test

14 rows selected.

3b)
Select * from ach_view
where C_id between 1 and 4;

      C_ID C_NAME	   C_TYPE     S      SCORE S_DESC
---------- --------------- ---------- - ---------- ---------------
	 1 Bannon	   Person     S 	 1 Swim
	 1 Bannon	   Person     F 	 3 Float
	 1 Bannon	   Person     C 	 3 Code
	 2 Myers	   Person     S 	 3 Swim
	 3 Neff 	   Person     S 	 2 Swim
	 3 Neff 	   Person     D 	 1 Design
	 4 Neff 	   Person     S 	 2 Swim
	 4 Neff 	   Person     F 	 2 Float

3c)
create or replace trigger INSERT_VIEW
INSTEAD OF insert on ach_view
for each row
    declare
        check_tuple integer;
    begin
        select count(*) into check_tuple
        from creature where C_id = :new.C_id;

        if check_tuple = 0 then
            Insert into Creature(C_id, C_name, C_type)
            values (:new.C_id, :new.C_name, :new.C_type);            
        end if;

        Insert into Achievement(C_id, S_code, score)
        values (:new.C_id, :new.S_code, :new.score);
    end;
/

Insert into ach_view(C_id, C_name, C_type, S_code, score)
values (9, 'Fanghorn', 'Ent', 'W', 3);

4)
Select C.C_id from Creature C
Join Achievement A on (C.C_id = A.C_id)
Join Skill S on (S.S_code = A.S_code)
where S.S_code in (Select S_code from jobskill J
                    where JobName = 'SWDeveloper')
group by C.C_id
having Count(*) = (Select count(*) from jobskill
                    where Jobname = 'SWDeveloper');

      C_ID
----------
	 5




